<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>부품 호환성 검사 | PC-Builder</title>
</head>
<body>
  <h1>PC-Builder</h1>
  <nav>
    <a href="index.html">홈</a> |
    <a href="compatibility.html">부품 호환성 검사</a> |
    <a href="#">가이드 견적</a> |
    <a href="#">PC 부품 선택 가이드</a> |
    <a href="#">게시판</a>
  </nav>

  <h2>부품 호환성 검사</h2>

  <div id="selectors">
    <label>CPU:
      <select id="cpu"></select>
    </label><br>

    <label>메인보드:
      <select id="board"></select>
    </label><br>

    <label>RAM:
      <select id="ram"></select>
    </label><br>

    <label>GPU:
      <select id="gpu"></select>
    </label><br>

    <label>PSU:
      <select id="psu"></select>
    </label><br>

    <label>케이스:
      <select id="case"></select>
    </label><br>
  </div>

  <button id="resetBtn">초기화</button>

  <h3>호환성 결과</h3>
  <div id="result">선택된 부품이 없습니다.</div>

  <script>
    const parts = ["cpu", "board", "ram", "gpu", "psu", "case"];
    const dataDir = "data/compatibility/";
    let selected = {};

    async function loadData() {
      for (const part of parts) {
        const response = await fetch(`${dataDir}${part}.json`);
        const items = await response.json();
        const select = document.getElementById(part);

        const defaultOption = document.createElement("option");
        defaultOption.value = "";
        defaultOption.textContent = `${part.toUpperCase()} 선택`;
        select.appendChild(defaultOption);

        items.forEach(item => {
          const option = document.createElement("option");
          option.value = item.name;
          option.textContent = item.name;
          select.appendChild(option);
        });

        select.addEventListener("change", () => {
          selected[part] = items.find(i => i.name === select.value);
          updateCompatibility();
        });
      }
    }

    function updateCompatibility() {
      const resultDiv = document.getElementById("result");
      const selectedParts = Object.values(selected).filter(Boolean);

      if (selectedParts.length === 0) {
        resultDiv.textContent = "선택된 부품이 없습니다.";
        return;
      }

      const errors = [];

      const cpu = selected.cpu;
      const board = selected.board;
      const ram = selected.ram;
      const gpu = selected.gpu;
      const psu = selected.psu;
      const pcCase = selected.case;

      // 간단한 호환성 규칙 예시
      if (cpu && board && cpu.socket !== board.socket) {
        errors.push(`CPU(${cpu.name})와 메인보드(${board.name})의 소켓이 맞지 않습니다.`);
      }

      if (board && ram && board.ramType !== ram.ramType) {
        errors.push(`메인보드(${board.name})와 RAM(${ram.name})의 규격이 맞지 않습니다.`);
      }

      if (pcCase && board && pcCase.formFactor !== board.formFactor) {
        errors.push(`케이스(${pcCase.name})와 메인보드(${board.name})의 크기가 맞지 않습니다.`);
      }

      if (pcCase && gpu && gpu.length > pcCase.gpuMaxLength) {
        errors.push(`케이스(${pcCase.name})에 GPU(${gpu.name})가 들어가지 않습니다.`);
      }

      if (psu && gpu && psu.watt < gpu.power) {
        errors.push(`PSU(${psu.name})의 전력이 GPU(${gpu.name})를 지원하기에 부족합니다.`);
      }

      if (errors.length > 0) {
        resultDiv.innerHTML = "❌ 호환성 문제 발견:<br>" + errors.join("<br>");
      } else {
        resultDiv.textContent = "✅ 모든 부품이 호환됩니다.";
      }
    }

    document.getElementById("resetBtn").addEventListener("click", () => {
      parts.forEach(p => {
        document.getElementById(p).value = "";
        selected[p] = null;
      });
      document.getElementById("result").textContent = "선택된 부품이 없습니다.";
    });

    loadData();
  </script>
</body>
</html>
